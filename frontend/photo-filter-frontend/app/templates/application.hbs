{{page-title "PhotoFilterFrontend"}}

{{! Inject services so template can read reactive state }}
{{this.currentAlbum}}
{{this.reload}}

<div
  class="h-screen w-screen overflow-hidden bg-base-200 text-base-content relative"
>
  <!-- ─── Top Navigation Bar ─────────────────────────────────────────────── -->
  <nav
    class="fixed top-0 left-0 right-0 h-16 z-50 bg-base-100 shadow flex items-center px-4 justify-between"
  >
    <a class="btn btn-ghost normal-case text-xl" href="/">Photo Filter</a>

    {{#if this.currentAlbum.isAlbumRoute}}
      <div class="flex items-center space-x-4">
        <!-- Current album title -->
        <h2 class="text-lg font-semibold">
          {{this.currentAlbum.albumTitle}}
        </h2>

        <!-- Sorting controls (unchanged) -->
        <div class="flex items-center space-x-2">
          <div class="form-control">
            <label class="label text-sm font-semibold">Sort by</label>
            <select
              id="sortAttribute"
              class="select select-xs select-bordered"
              {{on "change" (fn this.updateSortAttribute)}}
            >
              {{#each this.currentAlbum.scoreAttributes as |attr|}}
                <option
                  value="score.{{attr}}"
                  selected={{eq
                    this.currentAlbum.sortAttribute
                    (concat "score." attr)
                  }}
                >
                  {{capitalize attr}}
                </option>
              {{/each}}
            </select>
          </div>

          <div class="form-control">
            <label class="label text-sm font-semibold">Order</label>
            <select
              id="sortOrder"
              class="select select-xs select-bordered"
              {{on "change" (fn this.updateSortOrder)}}
            >
              <option
                value="desc"
                selected={{eq this.currentAlbum.sortOrder "desc"}}
              >Descending</option>
              <option
                value="asc"
                selected={{eq this.currentAlbum.sortOrder "asc"}}
              >Ascending</option>
            </select>
          </div>
        </div>
      </div>
    {{/if}}
  </nav>

  <!-- ─── Library‑Updated Pill (appears on any stale album) ──────────────── -->
  {{#if (gt this.reload.staleAlbums.size 0)}}
    <div
      class="fixed top-16 left-1/2 -translate-x-1/2 bg-info text-info-content px-3 py-1 rounded shadow"
    >
      Library updated — click ↻ next to an album to refresh
    </div>
  {{/if}}

  <!-- ─── Main Layout: Side Nav + Outlet ─────────────────────────────────── -->
  <div class="h-full w-full pt-16 flex">
    <!-- Left Navigation Column -->
    <aside
      class="w-64 bg-gray-100 border-r border-gray-300 h-full overflow-auto p-4"
    >
      <TimeNav />

      <h3 class="text-lg font-semibold mb-2 mt-4">Albums</h3>
      <ul class="space-y-1">
        {{#each this.model as |album|}}
          <li>
            <LinkTo
              @route="albums.album"
              @model={{album.id}}
              class="hover:underline"
            >
              {{album.title}}
            </LinkTo>
          </li>
        {{/each}}
      </ul>
    </aside>

    <!-- Routed Content -->
    <main class="flex-1 overflow-auto p-4">
      {{outlet}}
    </main>
  </div>
</div>